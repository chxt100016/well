<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="org.wella.front.fkf.mapper.FrontFkfCreditMapper">
	<!-- select -->
	<!-- 获得授信目录的函数 -->
	<select id = "getCreditList" parameterType = "java.util.Map" resultType = "java.util.Map">
		SELECT *
		FROM wa_credit a 
		INNER JOIN wa_user b ON a.user_id = b.user_id
		INNER JOIN wa_userinfo c ON b.user_id = c.user_id
		<where>
			<if test = "creditUserId != null">
				AND a.credit_user_id = #{creditUserId} 
			</if>
			<if test = "gtCreditOverDate != null">
				AND a.credit_over_date &lt; #{gtCreditOverDate} 
			</if>
			<if test = "creditState != null">
				AND a.credit_state = #{creditState}
			</if>
			<if test = "creditState == null">
				AND (a.credit_state = 2 OR a.credit_state = -2 OR a.credit_state = 3)
			</if>
			<if test = "userName != null">
				AND b.user_name LIKE '%${userName}%' 
			</if>
		</where>
		ORDER BY a.user_id, a.credit_id DESC 
		LIMIT ${start},${size}
		
	</select>	
	<!-- 获得授信目录个数的函数 -->
	<select id = "getCreditListCount" parameterType = "java.util.Map" resultType = "int">
		SELECT COUNT(*)
		FROM wa_credit  a 
		INNER JOIN wa_user b ON a.user_id = b.user_id
		<where>
			<if test = "creditUserId != null">
				AND a.credit_user_id = #{creditUserId} 
			</if>
			<if test = "gtCreditOverDate != null">
				AND a.credit_over_date &lt; #{gtCreditOverDate} 
			</if>
			<if test = "creditState != null">
				AND a.credit_state = #{creditState}
			</if>
			<if test = "creditState == null">
				AND (a.credit_state = 2 OR a.credit_state = -2 OR a.credit_state = 3)
			</if>
			<if test = "userName != null">
				AND b.user_name LIKE '%${userName}%' 
			</if>
		</where>
	</select>
	
	<!-- 获得授信信息的函数 -->
	<select id = "getCreditInfo" parameterType = "java.util.Map" resultType = "java.util.Map">
		SELECT *
		FROM wa_credit a 
		INNER JOIN wa_user b ON a.user_id = b.user_id
		INNER JOIN wa_userinfo c ON b.user_id = c.user_id
		<where>
			<if test = "creditId != null">
				AND a.credit_id = #{creditId} 
			</if>
		</where>
	</select>
</mapper>