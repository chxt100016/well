<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.wella.houtai.enterprise.mapper.UserMapper">
	<!-- 获取商品分类目录信息 (API) -->
	<select id="getUserList" parameterType="java.util.Map"	resultType="java.util.Map">
	<choose>
			<when test="userType==4">
				SELECT
				t1.*, t2.regName as ghfName
				FROM wa_user as t1 LEFT JOIN wa_user as t2 ON t1.gonghuofang = t2.id		
				WHERE t1.state = #{searchType} AND t1.userType = 1  AND
				(t1.enterpriseName like CONCAT('%', '${searchKey}', '%') OR
				t1.regName like CONCAT('%', '${searchKey}', '%') OR
				t1.mobileAddr like CONCAT('%', '${searchKey}', '%') ) AND t1.shenheren = #{shenheren}  
				ORDER BY ${sort}
				LIMIT #{start} , #{pageSize}
			 
			</when>			
			<otherwise>
				SELECT
				wa_user.*, wa_admin.adminName , t.regName as ghfName
				FROM wa_user LEFT JOIN wa_admin ON wa_user.shenheren = wa_admin.id LEFT JOIN wa_user as t
				ON wa_user.gonghuofang = t.id		
				WHERE wa_user.state = #{searchType} AND wa_user.userType = #{userType}  AND
				(wa_user.enterpriseName like CONCAT('%', '${searchKey}', '%') OR
				wa_user.regName like CONCAT('%', '${searchKey}', '%') OR
				wa_user.mobileAddr like CONCAT('%', '${searchKey}', '%') ) 
				ORDER BY ${sort}
				LIMIT #{start} , #{pageSize}
			</otherwise>
		</choose>	
	</select>
	<select id="getShenherenList" 	resultType="java.util.Map">
		SELECT
		*
		FROM wa_admin 		
		WHERE adminLevel = 2 ORDER BY id		
	</select>
	<select id="getGonghuofangList" 	resultType="java.util.Map">
		SELECT
		*
		FROM wa_user 		
		WHERE userType = 2 ORDER BY id		
	</select>
	<select id="getUserInfo" parameterType="java.util.Map"	resultType="java.util.Map">
		SELECT * FROM wa_user WHERE id = #{selIdx} 
	</select>
	
	<select id="getUserCount" parameterType="java.util.Map"	resultType="java.util.Map">
		SELECT count(*)as totalCount FROM wa_user WHERE state = #{searchType}
		<if test = "userType==4">
		 AND userType = 1 AND shenheren = #{shenheren}
		 </if>
		 <if test = "userType!=4">
		 AND userType = #{userType}
		 </if>
		
	</select>
	
	<select id="getDuplicateCount" parameterType="java.util.Map"	resultType="java.util.Map">
		SELECT count(*)as cnt FROM wa_user WHERE ( regName like '${regName}'  
			OR mobileAddr like '${mobileAddr}' )  AND Not(id = #{selIdx})   	
	</select>
	
	<update id="setLockState" parameterType="java.util.Map"	>
		UPDATE wa_user SET isLock = #{state} WHERE id = #{selIdx} 
	</update>
	
	<update id="setState" parameterType="java.util.Map"	>
		UPDATE wa_user SET state = #{state} , commet = '${reason}' , shenheren = #{shenheren} , gonghuofang = 0		
		 WHERE id = #{selIdx} 
	</update>
	
	<update id="setGonghuofang" parameterType="java.util.Map"	>
		UPDATE wa_user SET state = #{state} , commet = '${reason}' , gonghuofang = #{gonghuofang}		
		 WHERE id = #{selIdx} 
	</update>
	
	<update id="saveUserInfo" parameterType="java.util.Map"	>
		UPDATE wa_user SET regName = '${regName}' , mobileAddr = '${mobileAddr}' 		
		 WHERE id = #{selIdx} 
	</update>
	
	<update id="saveUserPass" parameterType="java.util.Map"	>
		UPDATE wa_user SET regPass = '${regPass}'  		
		 WHERE id = #{selIdx} 
	</update>
	
	<delete id="deleteData" parameterType="java.util.Map"	>
		DELETE FROM wa_user  WHERE id = #{selIdx} 
	</delete>


</mapper>