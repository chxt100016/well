<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="org.wella.front.customer.mapper.CustomerBackOrderMapper">
	
	<!-- 获取订单列表 -->
	<select id="getWaOrderList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT a.order_id, a.order_no, a.prod_id, a.sale_num, a.sale_money, a.sale_sj_num, a.sale_sj_money, a.order_state, DATE(a.order_date) as order_date, a.is_self_car, b.prod_name, b.prod_img 
			FROM wa_order as a INNER JOIN wa_prod as b ON a.prod_id = b.prod_id
			WHERE a.user_id = #{userId}
			<if test="orderState!=null and orderState!=''">
				AND a.order_state = #{orderState} 
			</if>
			ORDER BY a.order_id DESC
			LIMIT ${start} , ${size}
	</select>
	
	<select id="getWaOrderListCount" parameterType="java.util.Map" resultType="int">
		SELECT count(*) 
			FROM wa_order as a INNER JOIN wa_prod as b ON a.prod_id = b.prod_id
			WHERE a.user_id = #{userId}
			<if test="orderState!=null and orderState!=''">
				AND a.order_state = #{orderState} 
			</if>
	</select>
	
	<!-- 获取订单列表 -->
	<select id="getWaUserVehicleList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT a.vehicle_trans, a.order_id, a.order_no, a.user_id, a.grab_id, a.money_id, a.pay_money, DATE(a.create_date) as create_date, a.vehicle_size, a.vehicle_state, b.prod_id, b.prod_name, b.prod_img, c.sale_sj_num 
			FROM wa_user_vehicle as a INNER JOIN wa_prod as b ON a.prod_id = b.prod_id INNER JOIN wa_order as c ON a.order_id = c.order_id
			WHERE a.user_id = #{userId} and a.vehicle_state > 0
			<if test="vehicleState!=null and vehicleState!=''">
				AND a.vehicle_state = #{vehicleState} 
			</if>
			ORDER BY a.vehicle_trans DESC
			LIMIT ${start} , ${size}
	</select>
	
	<select id="getWaUserVehicleListCount" parameterType="java.util.Map" resultType="int">
		SELECT count(*) 
			FROM wa_user_vehicle as a INNER JOIN wa_prod as b ON a.prod_id = b.prod_id INNER JOIN wa_order as c ON a.order_id = c.order_id
			WHERE a.user_id = #{userId} and a.vehicle_state > 0
			<if test="vehicleState!=null and vehicleState!=''">
				AND a.vehicle_state = #{vehicleState} 
			</if>
	</select>

        <!-- 获取订单列表 -->
	<select id="getEstiList" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT order_id, order_no, prod_id, prod_name, sale_sj_num, sale_sj_money, pj_state, pj_content 
			FROM wa_order as a
			WHERE a.user_id = #{userId} and a.order_state = 7
			<if test="pjState!=null and pjState!=''">
				AND a.pj_state = #{pjState} 
			</if>
			ORDER BY a.order_id DESC
			LIMIT ${start} , ${size}
	</select>
	
	<select id="getEstiListCount" parameterType="java.util.Map" resultType="int">
		SELECT count(*) 
			FROM wa_order as a
			WHERE a.user_id = #{userId} and a.order_state = 7
			<if test="pjState!=null and pjState!=''">
				AND a.pj_state = #{pjState} 
			</if>
	</select>
</mapper>