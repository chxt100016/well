<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.wella.front.sender.mapper.FrontSenderVehicleGrabMapper">
	<!-- 获得抢单列表的函数 -->				
	<select id="getQdList" parameterType="java.util.Map"  resultType = "java.util.Map"  >
		SELECT *
		FROM wa_vehicle_grab  a
		INNER JOIN wa_order b ON a.order_id = b.order_id  
		INNER JOIN wa_user c ON b.user_id = c.user_id 
		INNER JOIN wa_userinfo d ON c.user_id = d.user_id
		<where> 
			<if test = "grabState != null" >
				AND a.grab_state = #{grabState}
			</if>
			<if test = "wlUserId != null">
				AND a.wl_user_id = #{wlUserId}
			</if>
			<if test = "orderNo != null">
				AND b.order_no LIKE '%${orderNo}%'
			</if>
		</where> 
		ORDER BY c.user_id , a.order_id DESC 
		LIMIT ${start},${size}
	</select>
	
	<!-- 获得抢单列表个数的函数 -->				
	<select id="getQdListCount" parameterType="java.util.Map"  resultType = "int"  >
		SELECT COUNT(*)
		FROM wa_vehicle_grab  a
		INNER JOIN wa_order b ON a.order_id = b.order_id  
		INNER JOIN wa_user c ON b.user_id = c.user_id 
		INNER JOIN wa_userinfo d ON c.user_id = d.user_id
		<where> 
			<if test = "grabState != null" >
				AND a.grab_state = #{grabState}
			</if>
			<if test = "wlUserId != null">
				AND a.wl_user_id = #{wlUserId}
			</if>
			<if test = "orderNo != null">
				AND b.order_no LIKE '%${orderNo}%'
			</if>
		</where>  
	</select>	
	
	<!-- 获得抢单信息的函数 -->				
	<select id="getQdInfo" parameterType="java.util.Map"  resultType = "java.util.Map"  >
		SELECT *
		FROM wa_vehicle_grab  a
		INNER JOIN wa_order b ON a.order_id = b.order_id  
		INNER JOIN wa_user c ON b.user_id = c.user_id 
		INNER JOIN wa_userinfo d ON c.user_id = d.user_id
		<trim prefix="WHERE" prefixOverrides="AND|OR"> 
			<if test = "grabId != null" >
				AND a.grab_id = #{grabId}
			</if>
		</trim> 
	</select>
</mapper>
